<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assessment Visualizations - Grow Therapy</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #F8F7F5;
            min-height: 100vh;
            display: flex;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 280px;
            background: #F8F7F5;
            border-right: 1px solid #E5E5E5;
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .logo {
            padding: 0 20px 30px;
            font-size: 1.5rem;
            font-weight: 700;
            color: #000000;
            border-bottom: 1px solid #E5E5E5;
            margin-bottom: 20px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #666666;
            text-decoration: none;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
            margin: 2px 0;
        }

        .nav-item:hover {
            background: #F0F0F0;
            color: #000000;
        }

        .nav-item.active {
            background: #8A2BE2;
            color: #FFFFFF;
            border-left-color: #8A2BE2;
        }

        .nav-item i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
        }

        /* Profile Section at Bottom */
        .profile-section {
            margin-top: auto;
            padding: 20px;
            border-top: 1px solid #E5E5E5;
        }

        .profile-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .profile-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #8A2BE2;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #FFFFFF;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .profile-details {
            flex: 1;
        }

        .profile-name {
            font-weight: 600;
            color: #000000;
            font-size: 0.9rem;
        }

        .profile-role {
            color: #666666;
            font-size: 0.8rem;
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            margin-left: 280px;
            background: #F8F7F5;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: #F8F7F5;
            padding: 30px;
            border-bottom: 1px solid #E5E5E5;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .back-link {
            color: #8A2BE2;
            text-decoration: none;
            font-size: 0.95rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
            color: #000000;
            margin: 10px 0;
        }

        .page-subtitle {
            color: #666666;
            font-size: 1rem;
            margin-bottom: 20px;
        }

        /* Content Area */
        .content-area {
            padding: 30px;
        }

        .content-card {
            background: #FFFFFF;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #E5E5E5;
            transition: box-shadow 0.2s ease;
            margin-bottom: 20px;
        }

        .content-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #000000;
        }

        /* Controls Section */
        .controls {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #000000;
        }

        .control-select {
            padding: 10px 12px;
            border: 1px solid #E5E5E5;
            border-radius: 8px;
            background: #FFFFFF;
            color: #000000;
            font-size: 0.9rem;
            cursor: pointer;
            transition: border-color 0.2s ease;
        }

        .control-select:focus {
            outline: none;
            border-color: #8A2BE2;
        }

        .control-select option {
            color: #000000;
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }

        .chart-container.large {
            height: 500px;
        }

        /* Question Analysis */
        .question-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .question-card {
            background: #FFFFFF;
            border: 1px solid #E5E5E5;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .question-title {
            font-size: 1rem;
            font-weight: 600;
            color: #000000;
            margin-bottom: 10px;
        }

        .question-text {
            color: #666666;
            font-size: 0.9rem;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .question-chart {
            height: 250px;
            position: relative;
            width: 100%;
        }

        /* Summary Stats */
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #FFFFFF;
            border: 1px solid #E5E5E5;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #8A2BE2;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666666;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .stat-trend {
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .stat-trend.positive {
            color: #28A745;
        }

        .stat-trend.negative {
            color: #DC3545;
        }

        .stat-trend.neutral {
            color: #666666;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .sidebar {
                width: 100%;
                position: relative;
                height: auto;
            }

            .main-content {
                margin-left: 0;
            }

            .question-analysis {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 15px 20px;
            }

            .content-area {
                padding: 20px;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .summary-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <div class="logo">growtherapy</div>
        
        <nav>
            <a href="#" class="nav-item">
                <i>üè†</i>
                Dashboard
            </a>
            <a href="#" class="nav-item">
                <i>üìä</i>
                Insights
            </a>
            <a href="#" class="nav-item">
                <i>üí¨</i>
                Messages
            </a>
            <a href="#" class="nav-item active">
                <i>üë§</i>
                Clients
            </a>
            <a href="#" class="nav-item">
                <i>üìÖ</i>
                Appointments
            </a>
            <a href="#" class="nav-item">
                <i>üí∞</i>
                Payouts
            </a>
            <a href="#" class="nav-item">
                <i>‚öôÔ∏è</i>
                Profile
            </a>
            <a href="#" class="nav-item">
                <i>üë•</i>
                Community
                <i class="external-icon">‚ÜóÔ∏è</i>
            </a>
        </nav>

        <!-- Profile Section -->
        <div class="profile-section">
            <div class="profile-info">
                <div class="profile-avatar">AE</div>
                <div class="profile-details">
                    <div class="profile-name">Anna Eaglin</div>
                    <div class="profile-role">Therapist</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <a href="treatment_tab.html" class="back-link">
                    <i>‚Üê</i>
                    Back to Treatment
                </a>
            </div>
            
            <h1 class="page-title">Assessment Visualizations</h1>
            <p class="page-subtitle">Analyze patient progress with detailed PHQ9 and GAD7 insights</p>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Controls Card -->
            <div class="content-card">
                <div class="card-header">
                    <h2 class="card-title">Visualization Controls</h2>
                </div>
                
                <div class="controls">
                    <div class="control-group">
                        <label class="control-label">Assessment Type</label>
                        <select id="assessmentSelect" class="control-select">
                            <option value="phq9">PHQ9 (Depression)</option>
                            <option value="gad7">GAD7 (Anxiety)</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">View Type</label>
                        <select id="viewTypeSelect" class="control-select">
                            <option value="overall">Overall Progress</option>
                            <option value="questions">Individual Questions</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Summary Stats -->
            <div class="summary-stats" id="summaryStats">
                <!-- Stats will be populated by JavaScript -->
            </div>

            <!-- Main Chart -->
            <div class="content-card">
                <div class="card-header">
                    <h2 class="card-title" id="chartTitle">Overall Progress</h2>
                </div>
                <div class="chart-container large">
                    <canvas id="mainChart"></canvas>
                </div>
            </div>

            <!-- Question Analysis -->
            <div class="content-card" id="questionAnalysisCard" style="display: none;">
                <div class="card-header">
                    <h2 class="card-title">Individual Question Analysis</h2>
                </div>
                <div class="question-analysis" id="questionAnalysis">
                    <!-- Question cards will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let mainChart = null;
        let questionCharts = [];

        // Sample data for demonstration
        const sampleData = {
            phq9: {
                questions: [
                    "Little interest or pleasure in doing things",
                    "Feeling down, depressed, or hopeless",
                    "Trouble falling or staying asleep, or sleeping too much",
                    "Feeling tired or having little energy",
                    "Poor appetite or overeating",
                    "Feeling bad about yourself",
                    "Trouble concentrating on things",
                    "Moving or speaking slowly",
                    "Thoughts that you would be better off dead"
                ],
                scores: [17, 15, 12, 9, 7, 5],
                dates: ['2024-01-15', '2024-02-15', '2024-03-15', '2024-04-15', '2024-05-15', '2024-06-15'],
                questionScores: [
                    [3, 2, 2, 1, 1, 1], // Question 1
                    [3, 3, 2, 1, 1, 1], // Question 2
                    [2, 2, 2, 1, 1, 0], // Question 3
                    [3, 2, 2, 1, 1, 1], // Question 4
                    [2, 2, 1, 1, 1, 1], // Question 5
                    [2, 2, 1, 1, 1, 0], // Question 6
                    [1, 1, 1, 1, 1, 1], // Question 7
                    [1, 1, 1, 1, 1, 0], // Question 8
                    [0, 0, 0, 0, 0, 0]  // Question 9
                ]
            },
            gad7: {
                questions: [
                    "Feeling nervous, anxious, or on edge",
                    "Not being able to stop or control worrying",
                    "Worrying too much about different things",
                    "Trouble relaxing",
                    "Being so restless that it's hard to sit still",
                    "Becoming easily annoyed or irritable",
                    "Feeling afraid as if something awful might happen"
                ],
                scores: [14, 12, 10, 8, 6, 4],
                dates: ['2024-01-15', '2024-02-15', '2024-03-15', '2024-04-15', '2024-05-15', '2024-06-15'],
                questionScores: [
                    [3, 2, 2, 1, 1, 1], // Question 1
                    [3, 3, 2, 1, 1, 1], // Question 2
                    [2, 2, 2, 1, 1, 0], // Question 3
                    [3, 2, 2, 1, 1, 1], // Question 4
                    [2, 2, 1, 1, 1, 1], // Question 5
                    [1, 1, 1, 1, 1, 1], // Question 6
                    [0, 0, 0, 0, 0, 0]  // Question 7
                ]
            }
        };

        // Load initial visualization
        window.onload = function() {
            // Check for URL parameters to pre-select assessment type
            const urlParams = new URLSearchParams(window.location.search);
            const assessmentParam = urlParams.get('assessment');
            
            if (assessmentParam === 'phq9' || assessmentParam === 'gad7') {
                document.getElementById('assessmentSelect').value = assessmentParam;
            }
            
            loadVisualization();
        };

        // Event listeners
        document.getElementById('assessmentSelect').addEventListener('change', loadVisualization);
        document.getElementById('viewTypeSelect').addEventListener('change', loadVisualization);

        function loadVisualization() {
            const assessmentType = document.getElementById('assessmentSelect').value;
            const viewType = document.getElementById('viewTypeSelect').value;
            
            updateSummaryStats(assessmentType);
            
            if (viewType === 'overall') {
                showOverallChart(assessmentType);
                hideQuestionAnalysis();
            } else {
                hideOverallChart();
                showQuestionAnalysis(assessmentType);
            }
        }

        function updateSummaryStats(assessmentType) {
            const data = sampleData[assessmentType];
            const latestScore = data.scores[data.scores.length - 1];
            const previousScore = data.scores[data.scores.length - 2];
            const change = latestScore - previousScore;
            
            const statsContainer = document.getElementById('summaryStats');
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${latestScore}</div>
                    <div class="stat-label">Current Score</div>
                    <div class="stat-trend ${change < 0 ? 'positive' : change > 0 ? 'negative' : 'neutral'}">
                        ${change < 0 ? '‚Üì' : change > 0 ? '‚Üë' : '‚Üí'} ${Math.abs(change)} from last assessment
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${data.scores[0]}</div>
                    <div class="stat-label">Baseline Score</div>
                    <div class="stat-trend neutral">Initial assessment</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${Math.round(((data.scores[0] - latestScore) / data.scores[0]) * 100)}%</div>
                    <div class="stat-label">Improvement</div>
                    <div class="stat-trend positive">Better than baseline</div>
                </div>
            `;
        }

        function showOverallChart(assessmentType) {
            const data = sampleData[assessmentType];
            const ctx = document.getElementById('mainChart').getContext('2d');
            
            if (mainChart) {
                mainChart.destroy();
            }
            
            mainChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.dates.map(date => new Date(date).toLocaleDateString()),
                    datasets: [{
                        label: `${assessmentType.toUpperCase()} Score`,
                        data: data.scores,
                        borderColor: '#8A2BE2',
                        backgroundColor: 'rgba(138, 43, 226, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#000000',
                                font: {
                                    size: 14,
                                    weight: '600'
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: assessmentType === 'phq9' ? 27 : 21,
                            ticks: {
                                color: '#666666',
                                font: {
                                    size: 12
                                }
                            },
                            grid: {
                                color: '#E5E5E5'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#666666',
                                font: {
                                    size: 12
                                }
                            },
                            grid: {
                                color: '#E5E5E5'
                            }
                        }
                    }
                }
            });
            
            document.getElementById('chartTitle').textContent = `${assessmentType.toUpperCase()} Overall Progress`;
        }

        function hideOverallChart() {
            if (mainChart) {
                mainChart.destroy();
                mainChart = null;
            }
        }

        function showQuestionAnalysis(assessmentType) {
            const data = sampleData[assessmentType];
            const container = document.getElementById('questionAnalysis');
            
            // Clear existing charts
            questionCharts.forEach(chart => chart.destroy());
            questionCharts = [];
            
            container.innerHTML = '';
            
            data.questions.forEach((question, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                
                const canvas = document.createElement('canvas');
                canvas.id = `questionChart${index}`;
                canvas.className = 'question-chart';
                
                questionCard.innerHTML = `
                    <div class="question-title">Question ${index + 1}</div>
                    <div class="question-text">${question}</div>
                `;
                questionCard.appendChild(canvas);
                container.appendChild(questionCard);
                
                // Wait for DOM to be ready, then create chart
                setTimeout(() => {
                    const ctx = canvas.getContext('2d');
                    const chart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: data.dates.map(date => new Date(date).toLocaleDateString()),
                            datasets: [{
                                label: `Score`,
                                data: data.questionScores[index],
                                borderColor: '#8A2BE2',
                                backgroundColor: 'rgba(138, 43, 226, 0.1)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.4,
                                pointBackgroundColor: '#8A2BE2',
                                pointBorderColor: '#FFFFFF',
                                pointBorderWidth: 2,
                                pointRadius: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 3,
                                    ticks: {
                                        stepSize: 1,
                                        color: '#666666',
                                        font: {
                                            size: 11
                                        }
                                    },
                                    grid: {
                                        color: '#E5E5E5',
                                        drawBorder: false
                                    }
                                },
                                x: {
                                    ticks: {
                                        color: '#666666',
                                        font: {
                                            size: 10
                                        },
                                        maxRotation: 45
                                    },
                                    grid: {
                                        color: '#E5E5E5',
                                        drawBorder: false
                                    }
                                }
                            },
                            elements: {
                                point: {
                                    hoverRadius: 6
                                }
                            }
                        }
                    });
                    
                    questionCharts.push(chart);
                }, 100);
            });
            
            document.getElementById('questionAnalysisCard').style.display = 'block';
            document.getElementById('chartTitle').textContent = `${assessmentType.toUpperCase()} Individual Questions`;
        }

        function hideQuestionAnalysis() {
            document.getElementById('questionAnalysisCard').style.display = 'none';
            questionCharts.forEach(chart => chart.destroy());
            questionCharts = [];
        }
    </script>
</body>
</html>